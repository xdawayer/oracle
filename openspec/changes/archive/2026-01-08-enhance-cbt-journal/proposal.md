# Proposal: enhance-cbt-journal

## Summary
全面优化 CBT 日记模块的用户体验、AI 内容质量与统计功能，涵盖 Bug 修复、写日记界面重构、日记解读优化、统计增强及 i18n 改进。

## Problem Statement
当前 CBT 日记模块存在以下问题：

### Bug 与兼容性
1. 主界面点击"2026年1月"按钮报错
2. dark/light 模式下部分图标（删除按钮、进度条）显示不清

### 写日记界面
3. 指引信息分散（灵感引导、星空指引、执行指引、示例分开显示），用户难以聚焦
4. 打开写日记界面后无操作会自动关闭，影响体验
5. "我的感受"输入方式不直观，已添加感受的展示位置不合理
6. 身体感受的部位 icon 全部相同，缺乏区分度
7. "脑内想法"、"支持证据"输入布局不够清晰

### 日记解读界面
8. 模块顺序不合理（"平衡性见地"应提前）
9. "宇宙背景"命名不够直白，应改为"占星解读"
10. 星座信息字体过大、排版不够条理
11. 详细解读内容不够深入，使用斜体影响可读性
12. 平衡性见地框体高度过大

### AI 内容质量
13. 执行建议中的"占星整合冥想"和"阴影对话"内容过于专业，小白用户难以理解

### 统计功能
14. 统计内容未按当前月份过滤，包含历史数据
15. 英文使用宋体，与整体风格不符
16. 情绪分类不精准（多为"其他未分类"）
17. 情绪配方圆环缺乏彩色区分
18. 练习建议显示在一行，不够清晰
19. 分析建议缺乏本命盘和行运盘深度结合

### 架构与 i18n
20. 写日记标题过于书面化，用户不清楚当前阶段记录什么
21. 专业术语与大白话建议未做区分

## Proposed Solution

### Phase 1: Bug 修复与基础 UI (P0)

| 需求 | 描述 |
|------|------|
| REQ-1 | 修复月份按钮点击报错 |
| REQ-2 | 日历表情放大至当前 1.2 倍 |
| REQ-3 | 移除写日记界面无操作自动关闭逻辑 |
| REQ-4 | dark/light 模式图标添加主题感知颜色 |

### Phase 2: 写日记界面重构 (P1)

| 需求 | 描述 |
|------|------|
| REQ-5 | 合并"灵感引导"和"星空指引"为"星空指引"，合并"执行指引"和"示例"为上下文依次显示；左侧整栏作为内容输入 |
| REQ-6 | "我的感受"改为表格式填写（感受→强度→添加），已添加感受在底部列表显示 |
| REQ-7 | 身体感受感知状态栏移至左侧底部，优化部位 icon 差异化 |
| REQ-8 | "脑内想法"调整为上下垂直架构 |
| REQ-9 | "支持证据"调整为上下垂直架构 |

### Phase 3: 日记解读界面优化 (P1)

| 需求 | 描述 |
|------|------|
| REQ-10 | "平衡性见地"移至第二模块（认知评估上方）；"宇宙背景"改为"占星解读" |
| REQ-11 | 星座信息不放大字体，逐条罗列，字体与认知评估正文一致 |
| REQ-12 | 详细解读内容扩展至 1.5 倍，移除斜体 |
| REQ-13 | 平衡性见地框体高度缩小至 0.8 |

### Phase 4: AI 内容质量提升 (P2)

| 需求 | 描述 |
|------|------|
| REQ-14 | 优化执行建议 Prompt，使"占星整合冥想"和"阴影对话"内容面向小白用户，避免专业术语 |

### Phase 5: 统计功能增强 (P2)

| 需求 | 描述 |
|------|------|
| REQ-15 | 统计内容按当前月份过滤，仅显示本月数据 |
| REQ-16 | 英文字体统一为系统 sans-seri，移除宋体 |
| REQ-17 | 优化情绪分类映射，减少"其他未分类" |
| REQ-18 | 情绪配方圆环使用彩色，对应心情图标颜色；悬停显示中文 |
| REQ-19 | 练习建议逐条展示，不显示在一行 |
| REQ-20 | 身体调节处方和星象觉察提醒解读更详细（移除斜体） |
| REQ-21 | 结合本命盘和行运盘进行深度分析 |

### Phase 6: i18n 优化 (P1)

| 需求 | 描述 |
|------|------|
| REQ-22 | 写日记标题清晰化，让用户明了当前阶段记录内容 |
| REQ-23 | 专业术语保持专业（如星座解读），建议使用大白话 |

## Scope

### In Scope
- `components/cbt/CBTMainPage.tsx` - 主界面
- `components/cbt/CBTWizard.tsx` - 写日记向导（重点重构）
- `components/cbt/CalendarStats.tsx` - 日历统计
- `components/cbt/ReportDashboard.tsx` - 日记解读
- `components/cbt/AnalysisViews.tsx` - 统计视图
- `components/cbt/MoodIcon.tsx` - 情绪图标
- `constants.ts` - TRANSLATIONS.journal
- `backend/src/prompts/manager.ts` - CBT Prompt 优化

### Out of Scope
- 后端存储结构变更
- CBT 记录数据模型变更
- 其他模块（Oracle 问答、本命盘等）的 UI 改动

## Dependencies
- 现有 CBT API 保持不变
- Recharts 图表库（统计圆环配色）
- lucide-react 图标库（部位 icon）

## Risks & Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| 写日记界面重构影响用户习惯 | Medium | Medium | 保持 10 步核心流程不变，仅优化布局 |
| Prompt 修改影响 AI 输出质量 | Medium | High | 逐步调整并 A/B 测试 |
| 统计月度过滤遗漏边界情况 | Low | Medium | 完善日期比较逻辑，覆盖时区 |
| 情绪分类映射不完整 | Medium | Low | 扩展映射表，保留兜底分类 |

## Success Criteria
1. 月份按钮点击无报错
2. 写日记界面左右分栏，指引信息合并，输入区域清晰
3. 日记解读模块顺序正确，样式优化，内容详尽
4. 统计功能仅显示当月数据，情绪圆环彩色
5. AI 执行建议内容面向小白用户，避免专业术语
6. 所有标题清晰直白，i18n 完整
