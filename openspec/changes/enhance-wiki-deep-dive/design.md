# Design: Wiki Deep Dive 内容生成架构

## 1. 架构决策

### 1.1 内容生成策略：离线批量生成 vs 在线实时生成

**决策：采用离线批量生成 + 静态存储**

| 方案 | 优点 | 缺点 |
|------|------|------|
| 离线批量生成 | 内容质量可控、无运行时成本、可人工审核 | 更新需重新生成 |
| 在线实时生成 | 内容可动态更新 | API 成本高、响应慢、质量不稳定 |

**理由**：
- 占星百科内容相对稳定，不需要频繁更新
- 用户期望快速加载，不能接受每次访问都等待 AI 生成
- 内容需要人工审核确保专业准确性

### 1.2 数据存储策略：单文件 vs 多文件

**决策：拆分为多个数据文件**

```
backend/src/data/
├── wiki.ts              # 主数据文件（基础信息）
├── wiki-planets.ts      # 行星深度内容
├── wiki-signs.ts        # 星座深度内容
├── wiki-houses.ts       # 宫位深度内容
├── wiki-aspects.ts      # 相位深度内容
├── wiki-concepts.ts     # 概念深度内容（元素、模式）
└── wiki-index.ts        # 统一导出入口
```

### 1.3 新增字段定义

在 `WikiItem` 类型中补充以下字段：

```typescript
interface WikiItem {
  // ... 现有字段 ...

  // 新增字段
  life_areas?: WikiLifeArea[];        // 影响的生活领域
  growth_path?: string;               // 成长路径建议
  practical_tips?: string[];          // 实用小贴士（3-5 条）
  common_misconceptions?: string[];   // 常见误解（2-3 条）
  affirmation?: string;               // 正向肯定语
}

interface WikiLifeArea {
  area: 'career' | 'love' | 'health' | 'finance' | 'family' | 'spiritual';
  description: string;
}
```

---

## 2. Prompt 模板完整拆解

### 2.1 行星类 Prompt 拆解（10 个）

#### 基础模板结构
```
你是一位专业的心理占星师，擅长将占星学与荣格心理学结合。
请针对【{{planet_name}}】进行深入的 8 步骤分析。

**行星基础信息：**
- 中文名：{{zh_name}}
- 英文名：{{en_name}}
- 符号：{{symbol}}
- 守护星座：{{ruling_signs}}
- 关联宫位：{{associated_houses}}
- 原型：{{archetype}}
- 核心关键词：{{keywords}}

**特殊侧重点：**
{{focus_points}}

请生成以下 8 个步骤的深度解读...
```

#### 行星专属变体

| ID | 名称 | 原型 | 核心关键词 | 特殊侧重点 |
|----|------|------|-----------|-----------|
| sun | 太阳 | 国王/英雄 | 自我、意志、生命力、父亲 | 英雄之旅叙事、自我实现、与父亲原型的关系、创造力表达 |
| moon | 月亮 | 母亲/疗愈者 | 潜意识、安全感、母亲、本能 | 内在小孩、情感需求、依恋模式、滋养与被滋养 |
| mercury | 水星 | 信使/商人 | 沟通、逻辑、学习、信息 | 思维模式、学习风格、沟通障碍、水逆影响 |
| venus | 金星 | 爱人/艺术家 | 爱、金钱、审美、和谐 | 爱的语言、价值观形成、自我价值、吸引力法则 |
| mars | 火星 | 战士/开拓者 | 行动、愤怒、性、驱动力 | 愤怒管理、性能量、竞争与合作、勇气培养 |
| jupiter | 木星 | 导师/探险家 | 扩张、幸运、哲学、意义 | 信念系统、过度膨胀风险、人生意义追寻、慷慨与贪婪 |
| saturn | 土星 | 严师/建筑师 | 限制、责任、结构、时间 | 土星回归、延迟满足、权威议题、恐惧与掌控 |
| uranus | 天王星 | 革命者/发明家 | 变革、自由、独创性、突发 | 个体化进程、叛逆与创新、集体无意识、突破性成长 |
| neptune | 海王星 | 神秘主义者/梦想家 | 梦想、灵感、成瘾、慈悲 | 灵性觉醒、边界溶解、成瘾与逃避、艺术与灵感 |
| pluto | 冥王星 | 炼金术士/萨满 | 转化、权力、死亡、重生 | 心理死亡与重生、权力议题、阴影整合、深层疗愈 |

#### 太阳专属 Prompt 示例

```markdown
**特殊侧重点：**
1. **英雄之旅叙事**：太阳代表我们的"英雄之旅"。分析太阳如何指引个体走向自我实现，克服内外障碍。
2. **父亲原型**：探讨太阳与父亲形象的关联，以及父亲缺席/在场如何影响太阳能量的发展。
3. **创造力与生命力**：太阳是生命的源泉，分析如何通过太阳能量激发创造力。
4. **自我认同危机**：当太阳能量受阻（如与土星/冥王星困难相位）时，如何处理身份认同问题。
5. **心脏与活力**：太阳对应身体的心脏，探讨生命力与健康的关联。

**阴影特质重点**：傲慢、自恋、控制欲、过度表演、忽视他人需求
**整合方向重点**：谦逊领导、真实表达、温暖照耀他人而非灼伤
```

---

### 2.2 星座类 Prompt 拆解（12 个）

#### 基础模板结构
```
你是一位专业的心理占星师，擅长将占星学与荣格心理学结合。
请针对【{{sign_name}}】进行深入的 8 步骤分析。

**星座基础信息：**
- 中文名：{{zh_name}}
- 英文名：{{en_name}}
- 符号：{{symbol}}
- 元素：{{element}}（{{element_traits}}）
- 模式：{{mode}}（{{mode_traits}}）
- 守护星：{{ruler}}
- 对宫星座：{{opposite_sign}}
- 身体对应：{{body_parts}}
- 核心关键词：{{keywords}}

**特殊侧重点：**
{{focus_points}}

请生成以下 8 个步骤的深度解读...
```

#### 星座专属变体

| ID | 名称 | 元素 | 模式 | 守护星 | 核心关键词 | 特殊侧重点 |
|----|------|------|------|--------|-----------|-----------|
| aries | 白羊座 | 火 | 基本 | 火星 | 冲动、勇气、领导、自我 | 开创能量、冲动管理、独立vs依赖、愤怒表达、竞争本能 |
| taurus | 金牛座 | 土 | 固定 | 金星 | 稳定、感官、价值、占有 | 物质安全感、感官享受、固执vs坚持、自我价值建立 |
| gemini | 双子座 | 风 | 变动 | 水星 | 沟通、好奇、多变、二元 | 双重性整合、信息过载、浅尝辄止vs深入、沟通障碍 |
| cancer | 巨蟹座 | 水 | 基本 | 月亮 | 情感、家庭、保护、记忆 | 情感边界、母亲情结、安全感来源、过度保护 |
| leo | 狮子座 | 火 | 固定 | 太阳 | 创造、表演、尊严、慷慨 | 自我表达、认可需求、创造力释放、傲慢vs自信 |
| virgo | 处女座 | 土 | 变动 | 水星 | 分析、服务、完美、健康 | 完美主义陷阱、批判vs辨识、身心整合、服务精神 |
| libra | 天秤座 | 风 | 基本 | 金星 | 平衡、关系、美、正义 | 关系依赖、决策困难、和谐追求、自我vs他人 |
| scorpio | 天蝎座 | 水 | 固定 | 冥王星/火星 | 转化、深度、控制、重生 | 信任议题、控制欲、情感深度、死亡与重生主题 |
| sagittarius | 射手座 | 火 | 变动 | 木星 | 自由、哲学、冒险、真理 | 意义追寻、承诺恐惧、过度乐观、文化探索 |
| capricorn | 摩羯座 | 土 | 基本 | 土星 | 野心、责任、结构、权威 | 成就焦虑、权威议题、情感压抑、长期目标 |
| aquarius | 水瓶座 | 风 | 固定 | 天王星/土星 | 革新、人道、独特、疏离 | 归属感困境、情感疏离、集体vs个人、未来愿景 |
| pisces | 双鱼座 | 水 | 变动 | 海王星/木星 | 梦想、共情、牺牲、超越 | 边界溶解、逃避现实、灵性追求、牺牲vs自我关爱 |

#### 白羊座专属 Prompt 示例

```markdown
**特殊侧重点：**
1. **开创能量**：作为黄道第一个星座，白羊代表新生命的爆发力。分析如何运用这股"开始"的能量。
2. **冲动管理**：火星守护带来的冲动性如何成为优势或障碍，如何在保持活力的同时培养耐心。
3. **独立vs依赖**：白羊座对独立的强烈需求，如何在亲密关系中平衡自主与连结。
4. **愤怒表达**：白羊座与愤怒的健康关系，如何将愤怒转化为建设性行动。
5. **竞争本能**：白羊座的竞争天性，如何从"打败他人"转向"超越自我"。
6. **对宫天秤座的整合**：学习合作、妥协与考虑他人视角。

**阴影特质重点**：冲动鲁莽、自私自利、缺乏耐心、攻击性、半途而废
**整合方向重点**：勇敢而非鲁莽、领导而非独裁、热情而非冲动
**成长课题**：学习等待、考虑后果、倾听他人、完成开始的事情
```

---

### 2.3 宫位类 Prompt 拆解（12 个）

#### 基础模板结构
```
你是一位专业的心理占星师，擅长将占星学与荣格心理学结合。
请针对【{{house_name}}】进行深入的 8 步骤分析。

**宫位基础信息：**
- 中文名：{{zh_name}}
- 英文名：{{en_name}}
- 自然守护星座：{{natural_sign}}
- 自然守护行星：{{natural_ruler}}
- 对宫：{{opposite_house}}
- 生活领域：{{life_areas}}
- 核心关键词：{{keywords}}

**特殊侧重点：**
{{focus_points}}

请生成以下 8 个步骤的深度解读...
```

#### 宫位专属变体

| ID | 名称 | 自然星座 | 守护星 | 生活领域 | 核心关键词 | 特殊侧重点 |
|----|------|---------|--------|---------|-----------|-----------|
| house-1 | 第1宫 | 白羊座 | 火星 | 自我形象、身体 | 面具、身份、外表、开始 | 人格面具形成、身体意象、第一印象、自我呈现方式 |
| house-2 | 第2宫 | 金牛座 | 金星 | 金钱、价值观 | 资源、自我价值、物质、才能 | 金钱心理、自我价值感、天赋发掘、安全感来源 |
| house-3 | 第3宫 | 双子座 | 水星 | 沟通、学习 | 思维、兄弟姐妹、短途、信息 | 学习风格、沟通模式、手足关系、日常思维习惯 |
| house-4 | 第4宫 | 巨蟹座 | 月亮 | 家庭、根基 | 家、父母、内在安全、晚年 | 原生家庭影响、内在安全感、家的意义、心理根基 |
| house-5 | 第5宫 | 狮子座 | 太阳 | 创造、恋爱 | 创造力、子女、快乐、表演 | 创造性表达、恋爱模式、与孩子的关系、玩乐能力 |
| house-6 | 第6宫 | 处女座 | 水星 | 工作、健康 | 服务、日常、疾病、习惯 | 身心健康、日常习惯、工作态度、服务精神 |
| house-7 | 第7宫 | 天秤座 | 金星 | 婚姻、合作 | 伴侣、合同、公开敌人、投射 | 伴侣选择模式、投射机制、合作vs竞争、关系业力 |
| house-8 | 第8宫 | 天蝎座 | 冥王星 | 深层转化 | 死亡、他人资源、性、重生 | 心理深度、亲密恐惧、资源共享、转化危机 |
| house-9 | 第9宫 | 射手座 | 木星 | 信仰、远方 | 哲学、高等教育、旅行、法律 | 信念系统、人生意义、文化扩展、精神导师 |
| house-10 | 第10宫 | 摩羯座 | 土星 | 事业、社会地位 | 职业、名望、权威、成就 | 职业使命、公众形象、与权威的关系、社会责任 |
| house-11 | 第11宫 | 水瓶座 | 天王星 | 团体、愿景 | 朋友、理想、团体、希望 | 归属感、社会愿景、友谊模式、个人与集体 |
| house-12 | 第12宫 | 双鱼座 | 海王星 | 潜意识、灵性 | 隐藏、牺牲、疗愈、解脱 | 潜意识模式、隐藏的敌人、灵性成长、业力清理 |

#### 第7宫专属 Prompt 示例

```markdown
**特殊侧重点：**
1. **伴侣选择模式**：第7宫揭示我们吸引什么样的伴侣，以及这种吸引背后的心理动力。
2. **投射机制**：荣格的投射理论如何解释我们在伴侣身上看到的"另一半"。
3. **合作vs竞争**：第7宫不仅是婚姻，也是所有一对一关系（包括公开敌人）的象征。
4. **关系业力**：从心理占星角度理解"灵魂伴侣"和关系中的重复模式。
5. **下降点的意义**：作为上升点的对宫，下降点代表我们需要整合的"非我"部分。
6. **与第1宫的整合**：在自我表达（第1宫）与关系适应（第7宫）之间找到平衡。

**阴影特质重点**：过度依赖、失去自我、投射阴影于伴侣、害怕独处
**整合方向重点**：在关系中保持完整自我、从伴侣身上收回投射、学习健康相互依存
**常见问题**：为什么总是吸引同类型的伴侣？如何打破关系中的重复模式？
```

---

### 2.4 相位类 Prompt 拆解（5 个）

#### 基础模板结构
```
你是一位专业的心理占星师，擅长将占星学与荣格心理学结合。
请针对【{{aspect_name}}】进行深入的 8 步骤分析。

**相位基础信息：**
- 中文名：{{zh_name}}
- 英文名：{{en_name}}
- 符号：{{symbol}}
- 角度：{{angle}}°
- 容许度：{{orb}}°
- 性质：{{nature}}（和谐/紧张/中性）
- 核心关键词：{{keywords}}

**特殊侧重点：**
{{focus_points}}

请生成以下 8 个步骤的深度解读...
```

#### 相位专属变体

| ID | 名称 | 角度 | 性质 | 核心关键词 | 特殊侧重点 |
|----|------|------|------|-----------|-----------|
| conjunction | 合相 | 0° | 中性/强化 | 融合、集中、强化、开始 | 能量融合vs混淆、新周期开始、焦点集中、行星性质决定好坏 |
| opposition | 冲相 | 180° | 紧张/觉察 | 对立、觉察、投射、平衡 | 内在矛盾外化、关系镜像、整合对立面、跷跷板效应 |
| square | 刑相 | 90° | 紧张/行动 | 挑战、摩擦、动力、危机 | 成长催化剂、内在冲突、行动压力、转化契机 |
| trine | 拱相 | 120° | 和谐/流动 | 天赋、流畅、懒散、支持 | 天生才能、过于顺利的陷阱、自然流动、需要主动激活 |
| sextile | 六合 | 60° | 和谐/机会 | 机会、合作、潜力、技能 | 需要把握的机会、合作能量、技能发展、温和支持 |

#### 刑相专属 Prompt 示例

```markdown
**特殊侧重点：**
1. **成长催化剂**：刑相不是"坏"相位，而是推动成长的内在张力。分析如何将摩擦转化为动力。
2. **内在冲突**：两颗行星的能量在 90° 角相遇时，如何理解这种"卡住"的感觉。
3. **行动压力**：与冲相的"觉察"不同，刑相创造的是"必须做点什么"的压力。
4. **转化契机**：每一个刑相都是一个转化的机会，分析如何利用这种张力。
5. **常见行星组合**：
   - 太阳刑月亮：意志与情感的冲突
   - 金星刑火星：爱与欲的拉扯
   - 土星刑冥王星：控制与转化的较量
6. **T 三角与大十字**：当刑相成为更大相位格局的一部分时的加强效应。

**阴影表现**：长期内耗、自我破坏、逃避挑战、投射冲突于外部
**整合方向**：承认张力存在、找到创造性出口、将压力转化为成就动力
**实用建议**：识别刑相触发的情境、发展两颗行星的"翻译官"能量
```

---

### 2.5 四元素细分 Prompt 拆解（4 个）

#### 元素专属变体

| ID | 名称 | 代表星座 | 荣格功能 | 核心关键词 | 特殊侧重点 |
|----|------|---------|---------|-----------|-----------|
| fire-element | 火元素 | 白羊、狮子、射手 | 直觉 | 精神、灵感、行动、信心 | 生命火花、创造驱动、愤怒与热情、燃烧与燃尽 |
| earth-element | 土元素 | 金牛、处女、摩羯 | 感觉 | 物质、结构、成果、安全 | 物质现实、身体意识、建构能力、固化与僵化 |
| air-element | 风元素 | 双子、天秤、水瓶 | 思考 | 交流、理念、关系、视角 | 思想流通、社交连结、客观视角、脱离与疏离 |
| water-element | 水元素 | 巨蟹、天蝎、双鱼 | 情感 | 情感、潜意识、融合、记忆 | 情感深度、共情能力、潜意识智慧、淹没与边界 |

#### 火元素专属 Prompt 示例

```markdown
**特殊侧重点：**
1. **生命火花**：火元素是生命的原初动力，分析火如何点燃我们的热情与意义感。
2. **荣格的直觉功能**：火元素对应直觉，如何通过直觉获取信息和做决策。
3. **三种火的表达**：
   - 白羊火：点燃的火柴，快速爆发
   - 狮子火：稳定燃烧的壁炉，温暖照耀
   - 射手火：野火蔓延，不断扩张
4. **火过多与火不足**：
   - 火过多：易怒、冲动、自我中心、燃烧殆尽
   - 火不足：缺乏动力、抑郁、难以行动、生命力低落
5. **与其他元素的互动**：
   - 火+土：实现愿景
   - 火+风：传播理念
   - 火+水：情感升华或蒸发
6. **发展火元素的方法**：运动、创造性表达、冒险活动、设定目标

**阴影表现**：傲慢、控制、破坏性愤怒、不顾后果
**整合方向**：温暖而非灼伤、照亮而非焚烧、激励而非压迫
```

---

### 2.6 三模式细分 Prompt 拆解（3 个）

#### 模式专属变体

| ID | 名称 | 代表星座 | 季节位置 | 核心关键词 | 特殊侧重点 |
|----|------|---------|---------|-----------|-----------|
| cardinal-mode | 基本模式 | 白羊、巨蟹、天秤、摩羯 | 季节开始 | 发起、领导、行动、开始 | 开创能量、领导力、缺乏持久力、四个方向的开始 |
| fixed-mode | 固定模式 | 金牛、狮子、天蝎、水瓶 | 季节高峰 | 坚持、稳定、专注、固执 | 深化能量、意志力、抗拒改变、四种固执的形式 |
| mutable-mode | 变动模式 | 双子、处女、射手、双鱼 | 季节结束 | 适应、灵活、变化、过渡 | 过渡能量、适应力、缺乏焦点、四种变通方式 |

---

### 2.7 四轴优化 Prompt 拆解（4 个）

现有四轴内容仅 2 步骤，需优化为 8 步骤。

| ID | 名称 | 对应宫位 | 核心关键词 | 特殊侧重点 |
|----|------|---------|-----------|-----------|
| ascendant | 上升点 | 第1宫 | 面具、身体、第一印象 | 人格面具形成、身体作为载具、与太阳的整合、早期环境编程 |
| descendant | 下降点 | 第7宫 | 伴侣、投射、阴影 | 投射机制、伴侣镜像、公开敌人、收回投射的整合过程 |
| midheaven | 中天 | 第10宫 | 事业、名望、天命 | 职业使命、社会角色、与 IC 的平衡、权威认同 |
| imum-coeli | 下中天 | 第4宫 | 根基、家庭、私密 | 心理根基、原生家庭、内在安全感、晚年归宿 |

---

### 2.8 虚点和小行星优化 Prompt 拆解（5 个）

现有内容仅 2 步骤，需优化为 8 步骤。

| ID | 名称 | 类型 | 核心关键词 | 特殊侧重点 |
|----|------|------|-----------|-----------|
| north-node | 北交点 | 虚点 | 命运、进化、陌生 | 灵魂成长方向、跳出舒适区、今生课题、与南交点的整合 |
| south-node | 南交点 | 虚点 | 过去、习惯、舒适区 | 前世模式、天生技能、过度依赖、需要放下的 |
| chiron | 凯龙星 | 小行星 | 伤痛、疗愈、导师 | 核心伤痛、伤口即礼物、疗愈他人、受伤的疗愈者原型 |
| lilith | 莉莉丝 | 小行星 | 阴影、原始、解放 | 被压抑的女性能量、拒绝顺从、野性自我、性与权力 |
| juno | 婚神星 | 小行星 | 婚姻、承诺、平等 | 婚姻期待、伴侣类型、权力平衡、忠诚议题 |

---

### 2.9 星盘类型优化 Prompt 拆解（4 个）

现有内容仅 2 步骤，需优化为 8 步骤。

| ID | 名称 | 核心关键词 | 特殊侧重点 |
|----|------|-----------|-----------|
| natal-chart | 本命盘 | 蓝图、潜能、命运 | 橡子理论、自性化地图、并非宿命、活出星盘的层次 |
| synastry-chart | 比较盘 | 互动、吸引、冲突 | 能量触发、投射机制、业力关系、没有完美配对 |
| composite-chart | 组合盘 | 第三实体、关系命运 | 关系的独立生命、中点原理、关系的目的、共同成长方向 |
| transit-chart | 行运盘 | 时机、触发、天气 | 宇宙天气预报、外行星行运、触发本命潜能、准备而非等待 |

---

## 3. 输出格式规范

### 3.1 JSON 输出结构

```json
{
  "id": "aries",
  "deep_dive": [
    {
      "step": 1,
      "title": "白羊座的基本含义：宇宙的第一声啼哭",
      "description": "**核心关键词：** 自我、冲动、勇气、领导、开创\n\n白羊座是黄道的第一个星座..."
    }
  ],
  "astronomy_myth": "在希腊神话中，白羊座对应金羊毛的故事...",
  "psychology": "从荣格心理学角度，白羊座代表了自我实现的原初冲动...",
  "shadow": "冲动鲁莽、自私自利、缺乏耐心、攻击性、半途而废...",
  "integration": "学习在保持热情的同时培养耐心，在追求独立的同时学会合作...",
  "life_areas": [
    { "area": "career", "description": "适合需要开创精神和领导力的工作..." },
    { "area": "love", "description": "在爱情中热烈主动，但需要学习持久经营..." }
  ],
  "growth_path": "白羊座的成长之路是从\"我要\"到\"我们要\"...",
  "practical_tips": [
    "冲动时数到 10 再行动",
    "设立短期目标获得成就感",
    "找到健康的愤怒出口如运动"
  ],
  "common_misconceptions": [
    "白羊座只会冲动不会思考（实际上他们的直觉往往很准）",
    "白羊座不适合长期关系（学会成长后可以很忠诚）"
  ],
  "affirmation": "我的勇气是礼物，我选择用它照亮而非灼伤。"
}
```

### 3.2 Markdown 格式规范

- 使用 `**粗体**` 标注核心概念
- 使用 `\n\n` 分段
- 列表使用 `-` 或数字编号
- 每个步骤描述 100-300 字
- 支持内嵌简单 Markdown（粗体、斜体、列表）

---

## 4. 生成脚本设计

### 4.1 脚本入口

```typescript
// backend/scripts/generate-wiki-content.ts

interface GenerationConfig {
  categories: ('planets' | 'signs' | 'houses' | 'aspects' | 'concepts')[];
  items?: string[];  // 可选：指定具体条目
  languages: ('zh' | 'en')[];
  dryRun?: boolean;  // 预览模式
}

async function main() {
  const config: GenerationConfig = {
    categories: ['signs'],
    languages: ['zh', 'en'],
    dryRun: false
  };

  await generateWikiContent(config);
}
```

### 4.2 错误处理与重试

```typescript
const MAX_RETRIES = 3;
const RETRY_DELAY = 2000;

async function generateWithRetry(prompt: string): Promise<GeneratedContent> {
  for (let i = 0; i < MAX_RETRIES; i++) {
    try {
      const result = await callDeepSeekAPI(prompt);
      validateContent(result);
      return result;
    } catch (error) {
      console.error(`Attempt ${i + 1} failed:`, error);
      if (i < MAX_RETRIES - 1) {
        await sleep(RETRY_DELAY * (i + 1));
      }
    }
  }
  throw new Error('Max retries exceeded');
}
```

### 4.3 内容验证

```typescript
function validateContent(content: GeneratedContent): void {
  // 1. deep_dive 步骤数量
  if (content.deep_dive.length < 4 || content.deep_dive.length > 8) {
    throw new Error('Invalid deep_dive step count');
  }

  // 2. 必填字段非空
  const requiredFields = ['astronomy_myth', 'psychology', 'shadow', 'integration'];
  for (const field of requiredFields) {
    if (!content[field] || content[field].length < 50) {
      throw new Error(`Field ${field} is missing or too short`);
    }
  }

  // 3. 无占位符文本
  const placeholderPatterns = ['编撰中', 'in progress', '...'];
  for (const pattern of placeholderPatterns) {
    if (JSON.stringify(content).includes(pattern)) {
      throw new Error(`Placeholder text detected: ${pattern}`);
    }
  }
}
```

---

## 5. 审核流程

### 5.1 生成后自动检查

1. 结构完整性检查（必填字段）
2. 内容长度检查（最小字符数）
3. 占位符文本检测
4. 中英文步骤数量一致性

### 5.2 人工审核清单

| 检查项 | 说明 |
|--------|------|
| 术语准确性 | 占星术语是否使用正确 |
| 心理学引用 | 荣格概念是否引用恰当 |
| 文化敏感性 | 是否有不当表述 |
| 实用性 | 建议是否具体可操作 |
| 语言流畅性 | 行文是否通顺自然 |
| 中英一致性 | 双语内容是否对应 |

### 5.3 审核工作流

```
生成完成 → 自动检查 → 输出待审核文件 → 人工审核 → 标记修改 → 重新生成/手动修复 → 合并到主文件
```
