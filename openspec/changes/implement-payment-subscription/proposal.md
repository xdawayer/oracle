# 付费与订阅系统实现

## 概述

为 AstroMind AI 引入完整的商业化能力，包括用户账户体系、订阅服务、单次购买、付费报告等功能。目标市场为欧美用户，采用低价获客 + 高频付费策略。

## 背景

当前应用所有功能免费开放，缺乏可持续的商业模式。需要：
1. 建立用户账户体系（支持云端数据同步）
2. 实现付费订阅与单次购买
3. 设计合理的免费/付费边界
4. 开发高价值付费报告

## 变更范围

### 1. 用户账户体系
- 注册/登录（Google、Apple、Email）
- 用户数据云端存储与同步
- localStorage 数据迁移

### 2. 支付集成
- Stripe 订阅与单次支付
- 后续支持 Apple IAP / Google Play Billing

### 3. 权益系统
- 免费权益与付费权益定义
- 前端权益校验与付费墙
- 后端权益验证

### 4. 订阅服务
- 单档订阅：$6.99/月 或 $49.99/年
- 订阅管理（开通、取消、续费、升级）

### 5. 单次购买
- Ask 问答、详情解读包、合盘解读、报告等

### 6. 付费报告
- P0：年度运势报告、月运报告
- P1：合盘深度报告、事业/职业报告
- P2+：财富报告、土星回归、行运预测

## 影响分析

| 领域 | 影响 |
|-----|------|
| 前端 | 新增登录UI、付费墙、订阅管理页、报告页面 |
| 后端 | 新增用户服务、支付服务、权益服务、报告生成服务 |
| 数据库 | 新增 users、subscriptions、purchases、reports 表 |
| 第三方 | Stripe、Google OAuth、Apple Sign In |

## 成功指标

- 注册转化率 > 30%
- 付费转化率 > 5%
- 订阅用户月留存 > 70%
- 单次购买复购率 > 20%

## 风险与缓解

| 风险 | 缓解措施 |
|-----|---------|
| AI Token 成本超支 | 保守定价（80%毛利）+ 用量监控 |
| 订阅取消率高 | 订阅专属内容 + 取消挽留流程 |
| 支付失败 | Stripe 自动重试 + 失败通知 |
| 滥用免费额度 | 设备指纹 + IP 限制 |

## 参考文档

- design.md - 详细设计决策
- tasks.md - 实施任务清单
- specs/ - 能力规范增量
